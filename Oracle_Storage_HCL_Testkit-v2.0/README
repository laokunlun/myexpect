Oracle VM 3.3 Storage HCL Testkit

The Storage HCL Testkit is a set of automated tests for certifying 
NAS and SAN storage arrays with Oracle VM 3.3

The Storage HCL Testkit allows vendors to certify their storage arrays
for use with OVM over FibreChannel, iSCSI, and NFS using either the 
Oracle Generic plugin or a vendor supplied Storage Connect plugin.  


Certification with the Oracle Generic SCSI Plugin[1]

   Certification of the storage array with FibreChannel or iSCSI
   using the Oracle Generic SCSI Plugin verifies standard storage
   operations using the generic SCSI plugin ensuring that discovery,
   refresh, and various LUN, repository, and multipath operations 
   can be performed on the storage array. The storage array can be 
   certified for either Fibre Channel or iSCSI (or both).  iSCSI
   certifications can include CHAP authentication[2]

Certification with the Oracle Generic NFS Plugin[3]

   Certification of the storage array with NFS using the Oracle 
   Generic NFS Plugin verifies network file server operations, 
   ensuring that the NFS server is properly recognized and usable
   by Oracle VM.

Certification with a vendor supplied SCSI Plugin
 
   Certification of the storage array with FibreChannel or iSCSI
   using a vendor supplied Storage Plugin verifies additional OVM
   features that are only available via vendor specific plugins.  
   The storage array may be certified for Fibre Channel or iSCSI
   (or both) with single or multiple paths to the storage array 
   through dm-multipath. The vendor specific storage plugin must
   be obtained from the storage vendor.

** For specific details about the test cases being run, please
   see the hw_storage_cert_ovm3.3 whitepaper, available from the
   URL where this testkit was downloaded.


Prerequisites:
1. Four servers on the same network.
   * One server configured as the OVM Manager Server (OVMM)
     The OVMM server can be a VM.
     ** The OVMM Manager must have the following configuration:
	* 6GB RAM (minimum)
	* 64bit x86_64 processor, 1.83GHz or more
	* Allocated Swap Space of 2.1GB or more
	* Hard disk with 5GB in /u01, and 2GB in /tmp
	* Oracle Database Standard Edition (SE)	  
	* One of the following Operating Systems
	  * Oracle Linux 5u5 (64bit) or newer
	  * Oracle Linux 6 (64bit) or newer
	  * RHEL 5u5 (64bit) or newer
	  * RHEL 6 (64bit) or newer

   * Two servers configured as Oracle VM Servers (OVS).  These will be
     referred to below as the Master and Secondary servers.  The 
     distinction between the Master and Secondary servers is arbitrary.
     ** Each of the two OVS Server nodes must have the following
        hardware configurations:
	* 4GB RAM (minimum)
	* 64 bit x86_64 processor
	* Hardware Virtualization support enabled (VT-x for Intel CPUs
	  and AMD-V for AMD CPUs)
	* Dual core CPU or multiple CPUs are recommended to run multiple 
	  guest operating systems

   * One server from which the testkit will be executed.  This can be a
     desktop machine or VM or even the same machine (or VM) as the OVMM
     server.  This server will be referred to below as the Test Server. 

2. A VM Network.  This can be the same public network as the four
   servers above, or a private network that is accessible by the
   two OVS servers.

3. A Storage array on the same public network as the four servers
   above, or on a private network that is accessible by the two OVS
   servers.
   * Must support the Fibre Channel and/or iSCSI protocols
   * Must support the creation of LUNs
   * Must support the mapping and unmapping of LUNs

4. A NAS Storage server (for NFS certification only) on the same public 
   network as the four servers above, or on a private network that is 
   accessible by the four servers.


5. Network access to downloadable OS ISO images for Virtual Machines.
   The testkit scripts will create Virtual Machines from ISO images.  
   You will need to supply the URL to a downloadable ISO image in 
   the configuration file. You can download ISO from Oracle's 
   Software Delivery Cloud, and upload them to your local HTTP File server.
   * Go to: https://edelivery.oracle.com/linux 
   * Login and accept the conditions.
   * Search for Oracle Linux 
   * Download DVD ISO image.
   * Upload the ISO image to a local HTTP File Server that is 
     accessible from your test server, and make note of the URL.
     You will need to enter this URL into the config file.
   * Please ensure that the ISO image you have downloaded is bootable.
     If the VM cannot boot from the ISO image, the tests will fail.
   
6. Network access to downloadable Virtual Machine Templates.  Templates
   must be in the .tgz format.

   The testkit scripts will create Virtual Machines from VM Templates.
   You will need to supply the URL to a downloadable VM Template
   on your local HTTP File Server, in the configuration file.  
   
   Download pre-built VM Templates from Oracle's Software
   Delivery Cloud:
   * Go to: https://edelivery.oracle.com/oraclevm
   * Login and accept the conditions.
   * Search for Oracle VM Templates, x86 64
   * Once you have the page full of search results, look for 
     "Oracle VM Templates for Oracle Enterprise Linux 5 Media Pack for x86_64 (64 bit)"
   * Download the .zip file
   * Unzip the .zip file
   * Upload the .tgz file to a local HTTP File Server that is accessible from
     your test server, and make a note of the URL to access the file.  
     You will need to enter this URL into the config file.   

7. Network access to a downloadable Virtual Machine Assembly.  Assembly
   files must be in either the .ovf or .ova format.

   The testkit scripts will create Virtual Machines from VM Assemblies.
   You will need to supply the URL to a downloadable VM Assembly
   on your local HTTP File Server, in the configuration file.
   You can download pre-built VM assemblies from Oracle's 
   Software Delivery Cloud, and upload them to your local HTTP
   file server:
   * Go to: https://edelivery.oracle.com/oraclevm
   * Login and accept the conditions.
   * Search for Oracle VM Templates, x86 64
   * Once you have the page full of search results, look for 
     "Oracle VM 3 Templates (OVF) for Oracle Linux 6 Media Pack for x86_64 (64 bit)"
   * Download the .zip file
   * Unzip the .zip file
   * Upload the .ovf (or .ova, depending on the package you downloaded)
     to a local HTTP File Server that is accessible from your test server,
     and make a note of the URL.  You will need to enter this URL 
     into your config file. 


Setup:
1. Install Oracle VM Server (OVS) on the two machines designated as
   the OVS Master and Secondary Servers.  View full instructions on 
   how to install the OVM Server in the OVM 3.3 Install Guide, 
   Chapter X:
   * http://docs.oracle.com/URL_GOES_HERE

2. Install Oracle VM Manager (OVMM) on the machine designated as the OVM
   Manager.  View full instructions on how to install the OVM Manager
   in the OVM 3.3 Install Guide, Chapter X:
   * http://docs.oracle.com/URL_GOES_HERE

3. Install the OVM Storage HCL Testkit on the Test Server:
   Software Prerequisites (Test Server only):
   * One of the following Operating Systems:
     * Oracle Linux 5u5 (64bit) or newer
     * Oracle Linux 6 (64bit) or newer
     * RHEL 5u5 (64bit) or newer
     * RHEL 6 (64bit) or newer
   * python
   * tcl
   * expect
   * gzip
   * tar
   * write access to /tmp
     (All of these software packages come standard in the OL5 and OL6 distribution)

   How to Install the testkit:
   Unpack the Oracle_Storage_HCL_Testkit-v2.0.tgz package in any directory on 
   the Test Server. 

 
Configuring the test environment for certificationwith the 
Oracle Generic SCSI Plugin

  FibreChannel Prerequisites:
  1. Using the native interface to the SAN storage array, 
     unmap any LUNs which have previously been mapped to the
     OVS Servers.
  2. Create 6 LUNs, but do not map them until prompted to do so:
     a. 30G, unmapped 
     b. 10G, unmapped 
     c. 10G, unmapped 
     d.  5G, unmapped 
     e.  5G, unmapped 
     f.  2G, unmapped 


  iSCSI Prerequisites:
  1. Using the native interface to the SAN storage array, 
     unmap any LUNs which have previously been mapped to the
     OVS Servers.
  2. Create 6 LUNs, but do not map them until prompted to do so:
     a. 30G, unmapped 
     b. 10G, unmapped 
     c. 10G, unmapped 
     d.  5G, unmapped 
     e.  5G, unmapped 
     f.  2G, unmapped 
  

Configuring the Environment for certification with a vendor supplied
Storage Connect plugin.

  After completing the certification tests for the Oracle Generic
  SCSI Plugin, 

  No specific setup is required to test and certify the storage array using 
  Fibre Channel or iSCSI with a Vendor-Specific Plugin. However, please note 
  the following:
  1. If the SAN Storage Array does not support having initiators mapped
     to multiple Access Groups, all Access Groups created for the 
     certification tests for the Oracle Generic SCSI Plugin MUST 
     be deleted prior to running the Vendor Plugin tests.
  2. All previously mapped LUNs should be unmapped from the OVS servers
     prior to starting the tests to avoid name collisions and disk
     space restrictions.
  3. If the plugin you are testing requires information in the Private Data
     field, you must set the PrivateDataSupported value in your config
     file to SUPPORTED, and the value for PluginPrivateData must be
     set with the expected data in the expected format.  Strings containing
     white space must be in double quotes.
  4. If the plugin you are testing does not require information in the
     Private Data field, you must set the PrivateDataSupported value
     in your config file to UNSUPPORTED.


Configuring the Environment for certification over NFS

  Prerequisites for NFS:
  1. Create two exportable filesystems on the storage array. The 
     filesystems should be a minimum of 20G each.
  2. On each of the filesystems, create these two directories:
     a. /export1  
     b. /export2
  3. Export the filesystems.


Running the Automated Tests:
The automated portion of the certification process is performed by the 
runCertificationTests script, which was installed into the directory 
where you uncompressed the HCL Test Kit tar file. 

Usage: runCertificationTests [-hlv] -c CONFIGFILE -t TESTNAME

Options:
  -h, --help            show this help message and exit
  -c CONFIGFILE, --config=CONFIGFILE
                        The full path to your config file.
  -l, --listTests       Use this option to get a listing of all the known
                        tests.
  -t TESTNAME, --test=TESTNAME
                        Specify the test to be run.  This will be the name of
                        the test in the TDF directory.
  -v, --verbose         If you would like more output, please select this
                        option.


A configuration file must be generated prior to running the tests.
Generation of the configuration file is done by executing the 
runCertificationTests script with the following options:

   ./runCertificationTests -t createStorageConfig

You will be prompted to enter the required information based
on the protocols you will be certifying.  A sample configuration 
file has been provided for your convenience.  Please see the 
ovm-hcl-config.sample in the same directory where you uncompressed 
the HCL Test Kit tar file.


Examples:
To list the names of all the available tests:

   ./runCertificationTests -l

To run the tests to certify the storage array for FibreChannel
using the Oracle Generic SCSI plugin with verbose output:

   ./runCertificationTests -t generic_fc -v -c ./my-config

To run the tests to certify the storage array for iSCSI
using the Oracle Generic SCSI plugin with verbose output:

   ./runCertificationTests -t generic_iscsi -v -c ./my-config

To run the tests to certify the storage array for iSCSI
with CHAP authentication, using the Oracle Generic SCSI 
plugin with verbose output:

   ./runCertificationTests -t generic_iscsi_chap -v -c ./my-config

To clean up the test environment after a test run has successfully
completed, or prior to kicking off a new test run in the event of a 
test failure.  It is strongly recommended that the cleanup scripts 
are run after every test run, and in between every test run in the 
event that multiple protocols are being certified:

   ./runCertificationTests -t storage_hcl_cleanup -c ./my-config

To gather all of the OVM and OVS logs prior to submitting your 
results to Oracle:

   ./runCertificationTests -t gather_ovm_logs
 


Automated Test Logs:
All of the test output and logs are written to a directory under /tmp/OVM_HCL
that is named based on the time stamp from the run start time.  For example:

     /tmp/OVM_HCL/125114-12032012

At the end of each run, AdminServer and CLI logs are gathered from the OVM 
Manager, then copied to the test run log directory.  The scripts also log
into the OVM Servers and run sosreport.  The resulting tarball, as well
as the ovs-agent logs are then copied to the test run log directory.
Finally, a tarball is generated from the contents of the log
directory.  The tarball is named ovm-storage-hcl_<timestamp>.tgz.
For example:  ovm-storage-hcl_125114-12032012.tgz

Submitting Results:
Please follow the instructions below for creating a certification request
in Bugzilla.

Oracle utilizes Bugzilla (http://bugzilla.oracle.com) to initiate certification 
results submission and to file bugs against the automated testkit. 

As Bugzilla is already used to submit bugs against Oracle Linux and Oracle VM, 
we have expanded the scope of this system to also include certification results
and bug submission. The process to initiate a new submission is outlined below:

1. Partners submitting their certification results will create a user 
   account on bugzilla.oracle.com and send email to the Oracle Partner Team 
   informing them about the creation of the account.

2. The Oracle team will coordinate with the Bugzilla administrator to grant 
   the new account the access rights necessary to submit certification results.

3. Once the account access rights are granted, the Oracle team will inform 
   the account creator that the account is ready.


4. Partners can now initiate a request to review the certification results 
   as described below. Note that the visibility of the entry, by default, 
   is restricted to the filer and the hardware certification team at Oracle. 
   If you wish to add visibility for other individuals, then please add their 
   email IDs in the CC list.

   a. Locate the tar file described under Automated Test Logs.
   b. Collect the completed checklists for the manual tests and create a tar file 
   c. Create a compressed tar file that includes the completed certification 
      checklists from the manual tests. Use the following convention to name 
      the file:

      <STORAGE-ARRAY-NAME-WITHOUT-SPACES>-<OVM-VERSION>-<DATE>.tar.gz
 
      Example:  
      Abc-Array-X100-OVM31-2012-12-31.tar.gz

   d. Log into sftp.oracle.com anonymously and upload the two tar files from a 
      and b above to the /support/incoming/ directory.
   e. Using the Bugzilla account you created above, login to 
      http://bugzilla.oracle.com and create a “New” request.
   f. From the product list, select “Oracle HW Test kit”. NOTE: if this product
      is not in the list, then steps 1 - 3 above have not been completed.
   g. From the component list, select “storage_cert”.
   h. In the summary field, enter the name of this certification project using
      a combination of server name and the Oracle VM version, preferably without 
      spaces, as follows:

      <STORAGE-ARRAY-NAME>-<OVM-VERSION>

      Example:
      Abc-Array-X100-OVM31


   i. Select the “Show Advanced Fields” link which will bring up some 
      previously hidden fields, one of which will be the URL field. Update t
      his URL field with the filename of the tar file that was uploaded to the
      oracle ftp site. You may add a brief description or comments in the 
      Description field before hitting “Submit Bug”.
   j. To re-upload log tar files, upload the new log tar files to the ftp site.
      Then update the comments in your Bugzilla request with the URL to your 
      newly uploaded file name. Change the “Status” field of the Bugzilla 
      request to “NEW” and submit.


Once the Bugzilla request is created and the logs are uploaded, the Oracle 
certification team will initiate the action to review the test results. The 
certification team will communicate the results or questions with the partner 
through this Bugzilla entry.

NOTE: The above process should be followed to facilitate the download and 
      review of logs quickly. This process is applicable to submit results 
      for both Generic Plugin and Storage Connect Plugin certifications.

For further information, please contact hcl-info_ww@oracle.com

OVM 3.3 Documentation: http://docs.oracle.com/cd/URL_GOES_HERE
OVM 3.3 User Guide: http://docs.oracle.com/cd/URL_GOES_HERE
OVM 3.3 Install Guide: http://docs.oracle.com/cd/URL_GOES_HERE
OVM 3.3 CLI Guide: http://docs.oracle.com/cd/URL_GOES_HERE 
OVM Overview and Technical White papers: http://www.oracle.com/technetwork/server-storage/vm/overview/index.html
Oracle Software Delivery Cloud: https://edelivery.oracle.com/

Known issues:
 1. iSCSI initiator names: The name in /etc/iscsi/initiatorname.iscsi is generated
    during the OVS install.  When running the Generic iSCSI tests, after you've 
    installed OVS on the servers, make sure to update the iSCSI Access Groups 
    on the storage array with the correct iSCSI IQN Names.  The tests will 
    fail when they can't find any LUNs, and with iSCSI, using the wrong IQN 
    Name is often the culprit when LUNs that have been mapped to the OVS servers
    don't show up in the OVM Manager.

 2. Running Vendor Plugin tests (Test Suite 2).  During a successful Vendor 
    Plugin test run, all LUNs and Access Groups which are created by the 
    scripts are also deleted by the scripts.  In the event of a test failure, 
    the LUNs and Access Groups may not be deleted.  LUN and Access Group 
    names are hard coded into the scripts, and therefore subsequent runs 
    of the Vendor Plugin tests will fail due to name collisions with previously
    created LUNs and Access Groups.  In the event of a test failure, the user
    will need to manually delete the LUNs and Access Groups created by the 
    scripts prior to re-running the tests.

 3. Creating Storage and VM networks.  Take note that when specifying ports 
    for the VM and Storage networks in the config file, that if you use bonded 
    NIC interfaces, you need to specify the bondX interface instead of ethX.  
    If there is a question of how the Ethernet ports have been configured on 
    your servers, check the output of ifconfig or view the ifcfg-ethX files 
    in /etc/sysconfig/network-scripts/ for specific details on how the ports 
    have been configured.

 4. Insufficient disk space.  During the clone tests (Vendor Plugin tests only), 
    if there is insufficient disk space available on the volume to create LUNs 
    and LUN clones, the tests will fail.  Please ensure there is adequate free 
    disk space on the volume (a minimum of 200G free before tests start) to 
    create all of the required LUNs and LUN clones. 

 5. iSCSI and CHAP Authentication during Generic Plugin tests.  During the 
    config file construction phase, the user is prompted to declare whether 
    or not CHAP Authentication is supported for iSCSI on the storage array 
    being certified.  If CHAP Authentication is not supported the 
    CHAP_Support variable in the config file must be set to UNSUPPORTED.

 6. If a fatal error is encountered during the execution of the tests, no 
    attempt to clean up the environment is made.  In the event that this
    happens, the user is strongly encouraged to run the cleanup scripts 
    prior to re-starting the tests.  This can be done by entering 
    the following command:

       ./runCertificationTests -t storage_hcl_cleanup -c ./my-config

 7. The script tries to wait a sufficient amount of time to allow storage 
    changes to be updated on the servers, and those changes to then be
    propagated to the OVM Manager.  Wait times have been specified by
    determining how long (on average) a job takes to complete and information
    to be propagated appropriately; however, on occasion, some operations
    take longer than expected and the specified wait times are not long 
    enough, and in those cases the test will fail. 

 8. The OVM CLI has a default timeout of 30 minutes before it terminates
    ssh sessions.  Occasionally some actions: e.g. downloading an iso image,
    take longer than 30 minutes to complete and the ssh session is terminated 
    by OVM while the testkit waits for the task to complete.  The testkit 
    will issue a watchdog timeout when a task takes longer than 29 minutes
    to complete, in order to avoid failures associated with trying to 
    issue commands over a closed ssh session.





Footnotes:
[1] Please refer to the OVM 3.3 User Guide, section X.X for more information 
    regarding the Oracle Generic SCSI plugin for FibreChannel and iSCSI.
    URL GOES HERE

[2] During certification of the storage array using iSCSI, certifying 
    the array using CHAP authentication is optional.  If it is desired
    to certify the array using CHAP authentication, the array will also
    be certified using non-CHAP authentication.

[3] Please refer to the OVM 3.3 User Guide, section X.X.X for more information
    regarding the Oracle Generic NFS plugin.  URL GOES HERE

[4] Access Groups are synonymous with Initiator Groups.  Access Group is the
    terminology used in the OVM documentation, OVM CLI, and OVM BUI.

[5] Access Group creation can be accomplished via the OVMM Manager, only when a
    vendor supplied storage connect plugin is installed on the OVS Server
    nodes.  Please refer to the OVM 3.3 User Guide, sections X.X.X.X 
    (URL GOES HERE) and X.X.X (URL GOES HERE) for more details on how to 
    create LUNs and Access Groups via the OVM Manager using a vendor supplied 
    storage connect plugin.

    If a vendor supplied storage connect plugin is not available, creating the
    LUNs and Access Groups for the OVS Servers, and the mapping of the LUNs
    to the Access Groups, must be executed using the native interface to the 
    SAN storage array

    Please refer to the OVM User Guide, section X.X for more information about
    how the tests will utilize the SAN Storage array during testing.
    URL GOES HERE

[6] Please refer to the OVM 3.3 User Guide, sections X.X.X (URL GOES HERE) 
    and X.X.X (URL GOES HERE) for more information on File Servers, and 
    configuring NFS exports.

